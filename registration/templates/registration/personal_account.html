{% extends 'users/base.html' %}

{% block content %}
<div class="container my-4">

<h1 class="mb-4">Профиль пользователя</h1>

<!-- Информация о пользователе -->
<div class="card mb-4 shadow-sm">
    <div class="card-body d-flex justify-content-between align-items-center mb-3">
        <h4 class="card-title mb-0">Информация о профиле</h4>
        <div class="btn-group" role="group" aria-label="Действия профиля">
            <a href="{% url 'users:users_update' user.pk %}" class="btn btn-outline-primary btn-sm">Редактировать профиль</a>
        </div>
    </div>
    <ul class="list-group list-group-flush">
        <li class="list-group-item"><strong>Email:</strong> {{ user.email }}</li>
        <li class="list-group-item"><strong>Телефон:</strong> {{ user.phone|default:"Нет данных" }}</li>
        <li class="list-group-item"><strong>Telegram chat_id:</strong> {{ user.tg_chat_id|default:"Нет данных" }}</li>
        <li class="list-group-item"><strong>Token:</strong> {{ user.token|default:"Нет данных" }}</li>
    </ul>
</div>

<!-- Активные записи -->
<section class="all-records mb-5">
    <h2 class="mb-3">Активные записи</h2>
    {% if current_bookings %}
        {% for registration in current_bookings %}
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Запись от {{ registration.date_registration|date:"d.m.Y" }}</h5>
                <ul class="list-group list-group-flush mb-3">
                    <li class="list-group-item"><strong>Время:</strong> {{ registration.time_registration|time:"H:i" }}</li>
                    <li class="list-group-item"><strong>Услуга:</strong> {{ registration.registration.service }}</li>
                    <li class="list-group-item"><strong>Кабинет:</strong> {{ registration.registration.cabinet_number }}</li>
                    <li class="list-group-item"><strong>Специалист:</strong> {{ registration.registration.doctor }}</li>
                </ul>
                <div class="d-flex gap-2 mt-3">
                    <a href="{% url 'registration:registration_update' registration.id %}" class="btn btn-primary btn-sm">Редактировать</a>
                    <form action="{% url 'registration:registration_delete' registration.id %}" method="post" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('Вы уверены, что хотите отменить запись?');">Отменить</button>
                    </form>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>Нет активных записей.</p>
    {% endif %}
</section>

<!-- История записей -->
<section class="past-records">
    <h2 class="mb-3 d-flex justify-content-between align-items-center">
        <span>История записей</span>
        <!-- Кнопка "Все записи" -->
        <a href="{% url 'registration:registration_list' %}" class="btn btn-secondary btn-sm">Все записи</a>
    </h2>
    {% if bookings_history %}
        {% for registration in bookings_history %}
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <h5 class="card-title mb-3">Запись от {{ registration.date_registration|date:"d.m.Y" }}</h5>
                <ul class="list-group list-group-flush mb-3">
                    <li class="list-group-item"><strong>Время:</strong> {{ registration.time_registration|time:"H:i" }}</li>
                    <li class="list-group-item"><strong>Услуга:</strong> {{ registration.registration.service }}</li>
                    <li class="list-group-item"><strong>Кабинет:</strong> {{ registration.registration.cabinet_number }}</li>
                    <li class="list-group-item"><strong>Специалист:</strong> {{ registration.registration.doctor }}</li>
                    {% if registration.result_file %}
                        <li class="list-group-item">
                            <strong>Результат услуги:</strong>
                            <a href="{{ registration.result_file.url }}" target="_blank" class="btn btn-sm btn-primary">
                                Скачать результат
                            </a>
                        </li>
                    {% else %}
                        <li class="list-group-item"><strong>Результат услуги:</strong> Нет данных</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p>История ваших записей пуста.</p>
    {% endif %}
</section>

</div>
{% endblock %}